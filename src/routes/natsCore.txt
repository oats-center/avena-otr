<script>
  async function getNatsMessages() {
    const response = await fetch('/nats/core');
    if (response.ok) {
      const result = await response.json();
      natsMessage = result.message;
      getNatsMessages();
    } else {
      console.error('Failed to fetch messages:', response.statusText);
    }
  }

  async function sendNatsMessage() {
    const response = await fetch("/nats/core", {
      headers: {"Content-Type": "application/json"},
      method: "POST",
      body: JSON.stringify({message: sentMessage})
    })
    if(response.ok){
      console.log("Message Sent Successfully");
    } else {
      console.error("Failed to send message: ", response.statusText);
    }
    sentMessage = "";  
  }
</script>

<div class="flex flex-col justify-center items-center">
  <h1 class="text-xl">Core</h1>
  <div class="flex mt-2">
    <div class="mx-10">
      <button class="btn btn-primary" onclick={getNatsMessages}>Start Message Flow</button>
      <h1>
        {natsMessage}
      </h1>
    </div>
    <div>
      <input type="text" placeholder="Send A Message" bind:value={sentMessage} class="input input-bordered w-full max-w-xs"/>
      <button class="btn btn-primary my-2" onclick={sendNatsMessage} >Send Message</button>
    </div>
  </div>
  <h1 class="mt-5 text-xl">Key Values</h1>
<div>

  